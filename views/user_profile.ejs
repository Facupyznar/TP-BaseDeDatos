<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8"/>
    <title>Perfil de Usuario</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>

<header class="header">
    <a class="home-btn" href="/">
        <img src="/imgs/casa3.png" alt="Inicio">
    </a>
</header>

<main class="container">
    <h1 class="center-text">Perfil de <%= user.user_name %></h1>

    <div class="center-text" style="color:var(--muted); margin-bottom:16px;">
        <div><strong>Usuario:</strong> <%= user.user_username %></div>
        <div><strong>Email:</strong> <%= user.user_email %></div>
    </div>

    <!-- Rese√±as/ratings/opiniones desde PG (movies.movie_user JOIN movies.movie) -->
    <h2 class="center-text">Mis calificaciones y opiniones</h2>
    <% if ((reviews || []).length > 0) { %>
        <ul class="review-list">
            <% reviews.forEach(r => { %>
                <li class="review-item card">
                    <div class="review-title">üé¨ <a href="/pelicula/<%= r.movie_id %>"><%= r.title %></a></div>
                    <% if (r.rating) { %><div class="review-rating">‚≠ê Puntaje: <%= r.rating %></div><% } %>
                    <% if (r.opinion) { %><div class="review-text"><%= r.opinion %></div><% } %>
                    <div style="margin-top:8px;">
                        <a class="btn-outline" href="/users/<%= user.user_id %>/movies/<%= r.movie_id %>/edit">Editar</a>
                    </div>
                </li>
            <% }) %>
        </ul>
    <% } else { %>
        <p class="center-text">Todav√≠a no calificaste ninguna pel√≠cula.</p>
    <% } %>

    <!-- Timeline reciente desde MongoDB: user_activity -->
    <h2 class="center-text">Actividad reciente</h2>
    <% if ((activities || []).length > 0) { %>
        <ul>
            <% activities.forEach(a => { %>
                <li class="card">
                    <div style="text-align:center">
                        <small style="color:var(--muted)"><%= new Date(a.timestamp).toLocaleString() %></small>
                        <div>
                            <% if (a.type === 'RATED_MOVIE') { %>
                                Calific√≥ la pel√≠cula <strong><%= a.details.movieTitle %></strong> con <strong><%= a.details.rating %></strong> ‚≠ê
                            <% } else if (a.type === 'WROTE_REVIEW') { %>
                                Escribi√≥ una rese√±a para <strong><%= a.details.movieTitle %></strong>
                            <% } else if (a.type === 'ADDED_TO_FAVORITES') { %>
                                A√±adi√≥ <strong><%= a.details.movieTitle %></strong> a favoritos
                            <% } else { %>
                                <em>Actividad</em>
                            <% } %>
                        </div>
                    </div>
                </li>
            <% }) %>
        </ul>
    <% } else { %>
        <p class="center-text">Sin actividad reciente.</p>
    <% } %>

    <% if (isAdmin){ %>
        <div class="center-text" style="margin-top:18px;">
            <a class="btn" href="/users">‚Üê Volver a la lista de usuarios</a>
        </div>
    <% } %>
</main>

</body>
</html>
