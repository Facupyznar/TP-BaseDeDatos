<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8"/>
    <title><%= movie.title %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>

<header class="header">
    <!-- Casa pequeña -->
    <a class="home-btn" href="/">
        <img src="/imgs/casa3.png" alt="Inicio">
    </a>
</header>

<main class="container">
    <h1 class="center-text"><%= movie.title %></h1>

    <h3 class="center-text">Fecha:</h3>
    <p class="center-text"><%= movie.release_date ? new Date(movie.release_date).toLocaleDateString() : '—' %></p>

    <h3 class="center-text">Géneros:</h3>
    <ul class="center-text">
        <% (movie.genres || []).forEach(g => { %>
            <li><%= g %></li>
        <% }) %>
        <% if (!movie.genres || !movie.genres.length) { %><li>—</li><% } %>
    </ul>

    <h3 class="center-text">Idioma(s):</h3>
    <ul class="center-text">
        <% (movie.languages || []).forEach(l => { %><li><%= l %></li><% }) %>
        <% if (!movie.languages || !movie.languages.length) { %><li>—</li><% } %>
    </ul>

    <h3 class="center-text">País(es):</h3>
    <ul class="center-text">
        <% (movie.countries || []).forEach(c => { %><li><%= c %></li><% }) %>
        <% if (!movie.countries || !movie.countries.length) { %><li>—</li><% } %>
    </ul>

    <h3 class="center-text">Dirigida por:</h3>
    <ul class="center-text">
        <% (movie.directors || []).forEach(d => { %>
            <li><a href="/director/<%= d.crew_member_id %>?from=movie"><%= d.crew_member_name %></a></li>
        <% }) %>
        <% if (!movie.directors || !movie.directors.length) { %><li>—</li><% } %>
    </ul>

    <h3 class="center-text">Escrita por:</h3>
    <ul class="center-text">
        <% (movie.writers || []).forEach(w => { %>
            <li><%= w.crew_member_name %></li>
        <% }) %>
        <% if (!movie.writers || !movie.writers.length) { %><li>—</li><% } %>
    </ul>

    <h3 class="center-text">Argumento:</h3>
    <div id="overview" class="center-text">
        <p><%= movie.overview || '—' %></p>
    </div>

    <h3 class="center-text">Elenco:</h3>
    <ul class="center-text">
        <% (movie.cast || [])
                .sort((a,b)=>(a.cast_order ?? 999)-(b.cast_order ?? 999))
        .forEach(a => { %>
            <li>
                <a href="/actor/<%= a.actor_id %>?from=movie"><%= a.actor_name %></a>
                <% if (a.character_name) { %> — <em><%= a.character_name %></em><% } %>
            </li>
        <% }) %>
        <% if (!movie.cast || !movie.cast.length) { %><li>—</li><% } %>
    </ul>

    <% if (typeof average_rating !== 'undefined' && average_rating !== null) { %>
        <p class="center-text">⭐ Promedio de usuarios: <strong><%= average_rating %></strong></p>
    <% } %>

    <% if (user) { %>
        <div class="review-section">
            <h3 class="center-text">Tu interacción</h3>

            <form class="review-form" action="/users/<%= user.id %>/movies/<%= movie.movie_id %>/rate" method="post">
                <label>Puntuación (1–5):</label>
                <input type="number" name="rating" min="1" max="5" required>
                <button type="submit" class="btn">Calificar</button>
            </form>

            <form class="review-form" action="/users/<%= user.id %>/movies/<%= movie.movie_id %>/opinion" method="post">
                <label>Comentario:</label>
                <textarea name="opinion" rows="4" placeholder="Escribí tu opinión…"></textarea>
                <button type="submit" class="btn">Enviar</button>
            </form>
        </div>
    <% } %>

    <div id="inicio" class="center-text"><a href="/">Inicio</a></div>
</main>

</body>
</html>
